# This workflow automatically creates a new branch when an issue is assigned.
# The branch name is generated from the issue number and title, and now
# includes a prefix based on the issue's labels.

name: Create Issue Branch

# This action is triggered when an issue is assigned.
on:
  issues:
    types: [assigned]

# Define the jobs for this workflow
jobs:
  determine_branch_name:
    runs-on: ubuntu-latest
    outputs:
      branch_name: ${{ steps.set_name.outputs.branch_name }}
    steps:
      - id: set_name
        name: Set dynamic branch name
        run: |
          # Use a default prefix if no matching label is found.
          prefix="GHS-FEATURE"
          
          # Check for labels and set the appropriate prefix.
          for label in ${{ toJSON(github.event.issue.labels.*.name) }}; do
            case $label in
              'bug')
                prefix="GHS-BUG"
                break
                ;;
              'task')
                prefix="GHS-TASK"
                break
                ;;
              'feature')
                prefix="GHS-FEATURE"
                break
                ;;
            esac
          done
          
          # Construct the full branch name and set it as a job output.
          branch_name="${prefix}-${{ github.event.issue.number }}"
          echo "Branch name will be: $branch_name"
          echo "branch_name=$branch_name" >> $GITHUB_OUTPUT

  create_branch:
    needs: determine_branch_name
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: write
    steps:
      - name: Create an issue branch
        uses: robv-oss/actions-create-issue-branch@v2.2.0
        with:
          branchName: ${{ needs.determine_branch_name.outputs.branch_name }}

# .github/workflows/auto-branch.yml
name: Auto Create Branch on Issue

on:
  issues:
    types: [opened]

jobs:
  create_branch:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Extract issue info
        id: vars
        run: |
          ISSUE_TITLE="${{ github.event.issue.title }}"
          ISSUE_TYPE="task"
          # Example: Detect keywords in title for type
          if [[ "$ISSUE_TITLE" =~ [Bb]ug ]]; then
            ISSUE_TYPE="bug"
          elif [[ "$ISSUE_TITLE" =~ [Ff]eature ]]; then
            ISSUE_TYPE="feature"
          fi
          # Replace spaces & special chars with underscores
          SAFE_TITLE=$(echo "$ISSUE_TITLE" | tr ' ' '_' | tr -cd '[:alnum:]_')
          echo "branch_name=${ISSUE_TYPE}/${SAFE_TITLE}-${{ github.event.issue.number }}" >> $GITHUB_OUTPUT

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Create branch
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git fetch origin
          git checkout -b "${{ steps.vars.outputs.branch_name }}" origin/main
          git push origin "${{ steps.vars.outputs.branch_name }}"
